{% extends "base.html" %}

{% block title %}Login - Calendário Sync{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center min-vh-100 align-items-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg border-0 rounded-lg">
                <div class="card-body p-5">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <div class="display-4 mb-3">
                            <i class="bi bi-calendar-event text-primary"></i>
                        </div>
                        <h1 class="h3 font-weight-bold mb-2">Calendário Sync</h1>
                        <p class="text-muted">Sincronização de Calendários</p>
                    </div>

                    <!-- Form -->
                    <form id="loginForm" method="POST">
                        <!-- Username -->
                        <div class="mb-3">
                            <label for="username" class="form-label">
                                <i class="bi bi-person"></i> Utilizador
                            </label>
                            <input 
                                type="text" 
                                class="form-control form-control-lg" 
                                id="username" 
                                name="username" 
                                placeholder="Introduza o seu utilizador"
                                required 
                                autofocus>
                            <div class="form-text">Credenciais fornecidas pelo administrador</div>
                        </div>

                        <!-- Password -->
                        <div class="mb-4">
                            <label for="password" class="form-label">
                                <i class="bi bi-lock"></i> Senha
                            </label>
                            <input 
                                type="password" 
                                class="form-control form-control-lg" 
                                id="password" 
                                name="password" 
                                placeholder="Introduza a sua senha"
                                required>
                        </div>

                        <!-- Error Message -->
                        {% if error %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="bi bi-exclamation-circle"></i>
                            {{ error }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endif %}

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                            <i class="bi bi-box-arrow-in-right"></i> Entrar
                        </button>

                        <!-- Loading State -->
                        <div id="loadingState" class="d-none">
                            <div class="spinner-border spinner-border-sm float-start mt-2" role="status">
                                <span class="visually-hidden">A carregar...</span>
                            </div>
                            <span class="ms-2">A autenticar...</span>
                        </div>
                    </form>

                    <!-- Footer -->
                    <hr class="my-4">
                    <div class="text-center text-muted small">
                        <p class="mb-0">
                            <i class="bi bi-shield-lock"></i>
                            Ligação Segura
                        </p>
                        <p class="mb-0">
                            Versão 1.0 | Janeiro 2026
                        </p>
                    </div>
                </div>
            </div>

            <!-- Support Info -->
            <div class="text-center mt-4">
                <small class="text-muted">
                    Problemas com login? Contacte o administrador.
                </small>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const loadingState = document.getElementById('loadingState');
    
    // Mostrar loading
    loadingState.classList.remove('d-none');
    
    // Fazer login
    fetch('/login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            username: username,
            password: password
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            window.location.href = data.redirect;
        } else {
            loadingState.classList.add('d-none');
            alert('Erro: ' + (data.error || 'Credenciais inválidas'));
        }
    })
    .catch(error => {
        loadingState.classList.add('d-none');
        alert('Erro de conexão. Tente novamente.');
    });
});
</script>
{% endblock %}